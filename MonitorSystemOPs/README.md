# Система мониторинга процессов компьютера "Справедливый Абрикос"

## Описание проекта
Проект представляет собой современную систему мониторинга системных ресурсов компьютера, разработанную на языке Rust. Система функционирует как служба Windows и предоставляет веб-интерфейс для просмотра метрик в реальном времени. Решение предназначено для системных администраторов и пользователей, нуждающихся в постоянном контроле за состоянием системы.

## Функциональность

### Основные возможности
- **Мониторинг системных ресурсов** - отслеживание CPU, памяти, дискового пространства и сетевой активности
- **Веб-интерфейс в реальном времени** - отображение метрик с автоматическим обновлением
- **Служба Windows** - автоматический запуск при старте системы
- **Исторические данные** - сохранение и просмотр истории метрик
- **Система уведомлений** - оповещения о критических состояниях системы
- **Защита конфигурации** - шифрование настроек и проверка прав доступа

### Мониторируемые метрики
- **Процессор**: процент использования, нагрузка на ядра
- **Память**: общий объем, использовано, процент использования
- **Дисковое пространство**: общий объем, свободно, процент использования
- **Сетевая активность**: входящий и исходящий трафик
- **Процессы**: количество активных процессов

## Технические требования

### Системное окружение
- **ОС**: Windows 10/11
- **Язык программирования**: Rust 1.70+
- **Система сборки**: Cargo
- **Дополнительно**: PowerShell для сбора системных метрик

### Необходимые зависимости
```toml
[dependencies]
tokio = { version = "1.0", features = ["full", "rt-multi-thread"] }
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
toml = "0.8.0"
chrono = { version = "0.4", features = ["serde"] }
warp = "0.3"
log = "0.4"
env_logger = "0.10"
anyhow = "1.0"
clap = { version = "4.0", features = ["derive"] }
windows-service = "0.6.0"
base64 = "0.21.0"
```

## Установка и сборка

### 1. Установка Rust
```bash
# Установка Rust через rustup (Windows)
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
# или скачайте с https://rustup.rs/

# Обновление PATH (требуется перезагрузка или перезапуск терминала)
rustup default stable
```

### 2. Сборка проекта
```bash
# Клонирование репозитория
git clone <repository-url>
cd "Справедливый Абрикос"

# Сборка в режиме отладки
cargo build

# Сборка в режиме релиза
cargo build --release
```

### 3. Установка и запуск службы
```bash
# Генерация конфигурации (требуются права администратора)
MonitorSystemOPs.exe config

# Установка службы (требуются права администратора)
MonitorSystemOPs.exe install

# Запуск службы
MonitorSystemOPs.exe start

# Запуск в консольном режиме (для отладки)
MonitorSystemOPs.exe run
```

## Структура проекта

```
Справедливый Абрикос/
├── src/
│   ├── main.rs              # Точка входа, CLI и основной цикл
│   ├── config.rs            # Конфигурация приложения
│   ├── monitor.rs           # Сбор системных метрик
│   ├── storage.rs           # Сохранение и загрузка данных
│   ├── service_manager.rs   # Управление службой Windows
│   ├── notification.rs      # Система уведомлений
│   └── security.rs          # Защита и шифрование конфигурации
├── config/
│   └── config.toml          # Файл конфигурации
├── data/
│   └── metrics.json         # База данных метрик
├── logs/
│   └── notifications.log    # Лог уведомлений
├── static/
│   └── simple_index.html    # Веб-интерфейс
├── Cargo.toml               # Конфигурация зависимостей
└── README.md                # Документация проекта
```

## Использование

### Управление службой
1. **Установка службы** - `MonitorSystemOPs.exe install` (требует админ права)
2. **Запуск службы** - `MonitorSystemOPs.exe start`
3. **Остановка службы** - `MonitorSystemOPs.exe stop`
4. **Перезапуск службы** - `MonitorSystemOPs.exe restart`
5. **Просмотр статуса** - `MonitorSystemOPs.exe status`
6. **Удаление службы** - `MonitorSystemOPs.exe uninstall` (требует админ права)

### Веб-интерфейс
После запуска службы веб-интерфейс доступен по адресу: `http://127.0.0.1:8080`

**Эндпоинты API:**
- `GET /metrics` - текущие метрики системы
- `GET /history` - исторические данные (параметр `limit` для ограничения)
- `GET /status` - статус службы

### Конфигурация
Файл `config/config.toml` позволяет настроить:
```toml
[monitoring]
interval_seconds = 30          # Интервал сбора метрик

[storage]
max_records = 1000            # Максимальное количество записей

[web]
host = "127.0.0.1"            # Хост веб-интерфейса
port = 8080                   # Порт веб-интерфейса
```

## Команды управления

| Действие | Команда | Права |
|----------|---------|-------|
| Установка службы | `MonitorSystemOPs.exe install` | Администратор |
| Удаление службы | `MonitorSystemOPs.exe uninstall` | Администратор |
| Запуск службы | `MonitorSystemOPs.exe start` | Любые |
| Остановка службы | `MonitorSystemOPs.exe stop` | Любые |
| Перезапуск службы | `MonitorSystemOPs.exe restart` | Любые |
| Статус службы | `MonitorSystemOPs.exe status` | Любые |
| Консольный режим | `MonitorSystemOPs.exe run` | Любые |
| Генерация конфига | `MonitorSystemOPs.exe config` | Любые |

## Особенности реализации

### Архитектура
- **Асинхронная обработка** - использование Tokio для высокопроизводительной обработки
- **Разделение ответственности** - модульная архитектура с четким разделением функций
- **Веб-интерфейс** - легковесный сервер на Warp с автоматическим обновлением
- **Служба Windows** - интеграция с системой через windows-service crate

### Сбор метрик
- **PowerShell интеграция** - использование системных команд для сбора данных
- **Кросс-платформенный подход** - возможность адаптации под другие ОС
- **Эффективное хранение** - JSON-формат для простоты и читаемости

### Безопасность
- **Проверка прав доступа** - верификация прав администратора для критических операций
- **Шифрование конфигурации** - защита настроек через base64 кодирование
- **Валидация конфигурации** - проверка целостности и прав доступа к файлам настроек

## Ограничения и известные проблемы
- Требуются права администратора для установки/удаления службы
- Веб-интерфейс доступен только на localhost по умолчанию
- Сбор метрик зависит от доступности PowerShell
- Ограниченная поддержка не-Windows систем

## Разработка и расширение

### Добавление новых метрик
1. Расширить структуру `SystemMetrics` в `monitor.rs`
2. Реализовать метод сбора данных в `ResourceMonitor`
3. Добавить отображение в веб-интерфейс

### Модификация веб-интерфейса
Редактировать файл `static/simple_index.html` для изменения интерфейса

### Настройка оповещений
Модифицировать пороги срабатывания в `monitor.rs::check_anomalies()`

## Сборка для распространения

```bash
# Сборка релизной версии
cargo build --release

# Файл будет доступен по пути:
# ./target/release/MonitorSystemOPs.exe
```

## Скрипты развертывания

### Установка (install.bat)
```batch
@echo off
echo Установка системы мониторинга "Справедливый Абрикос"...

:: Проверка прав администратора
net session >nul 2>&1
if %errorLevel% neq 0 (
    echo ERROR: Требуются права администратора
    pause
    exit /b 1
)

MonitorSystemOPs.exe config
MonitorSystemOPs.exe install
MonitorSystemOPs.exe start

echo Система успешно установлена и запущена!
echo Веб-интерфейс: http://localhost:8080
pause
```

### Удаление (uninstall.bat)
```batch
@echo off
echo Удаление системы мониторинга...

net session >nul 2>&1
if %errorLevel% neq 0 (
    echo ERROR: Требуются права администратора
    pause
    exit /b 1
)

MonitorSystemOPs.exe stop
MonitorSystemOPs.exe uninstall

echo Система успешно удалена
pause
```

## Дополнительные материалы
- [Документация Tokio](https://tokio.rs/)
- [Руководство по Warp](https://docs.rs/warp/)
- [Windows Service Crate](https://docs.rs/windows-service/)
- [Книга по Rust](https://doc.rust-lang.org/book/)


